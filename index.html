<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>PF 2026 | AuraManifest Sync FIX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --aura-cyan: #00f2ff; --aura-magenta: #ff00ff; }
        body { background: #000; margin: 0; overflow: hidden; font-family: 'Share Tech Mono', monospace; color: var(--aura-cyan); }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
        #ui-layer { position: relative; z-index: 10; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; }
        #ui-layer * { pointer-events: auto; }
        .btn-cyber { padding: 12px 40px; background: rgba(0,0,0,0.8); border: 1px solid var(--clr); color: var(--clr); cursor: pointer; transition: 0.3s; width: 320px; text-align: center; font-weight: bold; letter-spacing: 2px; }
        .btn-cyber:hover { background: var(--clr); color: #000; box-shadow: 0 0 20px var(--clr); }
        .input-cyber { background: rgba(0,0,0,0.7); border: 1px solid rgba(0,242,255,0.3); color: #fff; padding: 10px; text-align: center; width: 320px; outline: none; margin: 10px 0; }
        #id-display { font-size: 1.5rem; border: 1px solid rgba(0,242,255,0.5); padding: 10px 20px; background: rgba(0,242,255,0.1); margin: 15px 0; letter-spacing: 5px; }
    </style>
</head>
<body>

    <canvas id="stage-canvas"></canvas>

    <div id="ui-layer">
        <h1 class="text-5xl font-bold tracking-[15px] mb-10">PF 2026</h1>
        
        <div id="host-controls" class="flex flex-col items-center">
            <button onclick="startHost()" id="host-btn" class="btn-cyber" style="--clr: var(--aura-cyan)">[ GENERATE NODE ID ]</button>
            <div id="node-info" class="hidden flex flex-col items-center">
                <div id="id-display">--- --- ---</div>
                <p class="text-[10px] opacity-50">SHARE THIS ID TO MOBILE DEVICE</p>
            </div>
        </div>

        <div class="h-px w-40 bg-white/10 my-8"></div>

        <div id="client-controls" class="flex flex-col items-center">
            <input type="text" id="target-id" placeholder="ENTER ID" class="input-cyber">
            <button onclick="startClient()" id="client-btn" class="btn-cyber" style="--clr: var(--aura-magenta)">[ SYNC MOBILE ]</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('stage-canvas');
        const ctx = canvas.getContext('2d');
        let drops = [];
        let peer = null;
        let conn = null;
        let rx = -1000, ry = -1000;

        // --- ANIMACE (VŽDY BĚŽÍ) ---
        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            drops = Array.from({length: 100}, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                s: Math.random() * 2 + 1,
                char: "0123456789ABCDEF"[Math.floor(Math.random()*16)]
            }));
        }

        function draw() {
            ctx.fillStyle = "rgba(0,0,0,0.15)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.font = "12px monospace";
            
            drops.forEach(d => {
                d.y += d.s;
                // Interakce se synchronizovanými souřadnicemi
                let dx = rx - d.x;
                let dy = ry - d.y;
                if(Math.sqrt(dx*dx + dy*dy) < 150) {
                    d.x -= dx * 0.05;
                }
                if(d.y > canvas.height) d.y = -20;
                ctx.fillStyle = "rgba(0, 242, 255, 0.3)";
                ctx.fillText(d.char, d.x, d.y);
            });
            requestAnimationFrame(draw);
        }

        // --- SYNCHRONIZACE LOGIKA ---

        // 1. HOST (PC)
        function startHost() {
            const shortId = Math.random().toString(36).substr(2, 6).toUpperCase();
            peer = new Peer(shortId);
            
            peer.on('open', id => {
                document.getElementById('host-btn').classList.add('hidden');
                document.getElementById('node-info').classList.remove('hidden');
                document.getElementById('id-display').innerText = id.match(/.{1,3}/g).join('-');
                console.log("Uzel připraven: " + id);
            });

            peer.on('connection', c => {
                conn = c;
                console.log("Mobil připojen!");
                conn.on('data', data => {
                    // Přijímáme data z mobilu
                    rx = data.x * canvas.width;
                    ry = data.y * canvas.height;
                });
            });

            peer.on('error', err => console.error("Peer Error:", err));
        }

        // 2. KLIENT (Mobil)
        function startClient() {
            const targetId = document.getElementById('target-id').value.replace(/-/g, '').trim().toUpperCase();
            if(!targetId) return alert("Zadej ID!");

            peer = new Peer(); // Mobil dostane náhodné ID
            peer.on('open', () => {
                conn = peer.connect(targetId);
                conn.on('open', () => {
                    document.getElementById('client-btn').innerText = "[ CONNECTED ]";
                    document.body.style.background = "#050005";
                    
                    // Posílání dotyku z mobilu na PC
                    window.addEventListener('touchmove', e => {
                        const touch = e.touches[0];
                        conn.send({
                            x: touch.clientX / window.innerWidth,
                            y: touch.clientY / window.innerHeight
                        });
                    });
                });
            });
        }

        window.onload = () => { initCanvas(); draw(); };
        window.onresize = initCanvas;
    </script>
</body>
</html>