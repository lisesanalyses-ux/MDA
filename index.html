<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>PF 2026 | AuraSync Master v15.3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --aura-cyan: #00f2ff; --aura-magenta: #ff00ff; }
        body { background: #000; margin: 0; overflow: hidden; font-family: 'Share Tech Mono', monospace; color: var(--aura-cyan); }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }
        #ui-layer { position: relative; z-index: 10; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; }
        #ui-layer * { pointer-events: auto; }

        /* PRUH - Posunut o dalších 10% (celkem 22.5% od okraje) */
        #ascii-decoder-stream {
            position: fixed; left: 22.5%; top: 0; height: 100vh; width: 60px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            gap: 4px; font-size: 20px; color: rgba(0, 242, 255, 0.15); z-index: 5; pointer-events: none;
        }

        /* EXTRA GLOW MATCHING EFEKT */
        .match-active { 
            color: #fff !important; 
            /* Vícevrstvé text-shadow pro extrémní záři */
            text-shadow: 
                0 0 10px #fff, 
                0 0 20px var(--aura-cyan), 
                0 0 40px var(--aura-cyan),
                0 0 60px var(--aura-cyan); 
            animation: bounce 0.4s infinite alternate; 
            background: rgba(0, 242, 255, 0.45); 
            padding: 2px 12px; 
            font-weight: bold;
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.5);
            border-radius: 2px;
        }
        @keyframes bounce { from { transform: translateY(0) scale(1.1); } to { transform: translateY(-15px) scale(1.2); } }

        /* SIDEBAR A FRAME */
        #side-menu {
            position: fixed; left: -320px; top: 0; width: 300px; height: 100vh;
            background: rgba(0, 5, 5, 0.98); border-right: 2px solid var(--aura-cyan);
            z-index: 2000; transition: 0.5s; padding: 60px 20px;
        }
        #side-menu.open { left: 0; }
        .menu-trigger { position: fixed; left: 20px; top: 20px; z-index: 2100; cursor: pointer; border: 1px solid var(--aura-cyan); padding: 10px; background: rgba(0,0,0,0.8); }
        #manifest-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 4000; display: none; flex-direction: column; }
        
        /* UI ELEMENTY */
        .btn-cyber { padding: 12px 40px; background: rgba(0,0,0,0.8); border: 1px solid var(--clr); color: var(--clr); cursor: pointer; transition: 0.3s; width: 320px; text-align: center; font-weight: bold; letter-spacing: 2px; text-transform: uppercase; }
        .btn-cyber:hover { background: var(--clr); color: #000; box-shadow: 0 0 25px var(--clr); }
        .input-cyber { background: rgba(0,0,0,0.7); border: 1px solid rgba(0,242,255,0.3); color: #fff; padding: 10px; text-align: center; width: 320px; outline: none; margin: 10px 0; }
        #id-display { font-size: 1.5rem; border: 1px solid rgba(0,242,255,0.5); padding: 12px; background: rgba(0,242,255,0.1); margin: 15px 0; letter-spacing: 5px; color: #fff; text-align: center; }
    </style>
</head>
<body>

    <div id="ascii-decoder-stream"></div>

    <div class="menu-trigger" onclick="toggleMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </div>

    <nav id="side-menu">
        <div class="p-4 border-b border-white/10 cursor-pointer hover:bg-cyan-900/20" onclick="openManifest()">01. Aura Manifest Frame</div>
        <div class="p-4 border-b border-white/10 cursor-pointer hover:bg-cyan-900/20" onclick="location.reload()">02. Hard Reboot</div>
    </nav>

    <div id="manifest-container">
        <div class="p-2 border-b border-cyan-900 bg-black flex justify-between items-center">
            <button onclick="closeManifest()" class="text-[10px] border border-cyan-900 px-6 py-2 text-cyan-400">[ BACK_TO_CORE ]</button>
        </div>
        <iframe id="manifest-frame" class="w-full flex-grow border-none" src=""></iframe>
    </div>

    <canvas id="stage-canvas"></canvas>

    <div id="ui-layer">
        <h1 class="text-6xl font-bold tracking-[20px] mb-12" style="text-shadow: 0 0 15px var(--aura-cyan);">PF 2026</h1>
        <div class="flex flex-col items-center">
            <button onclick="startHost()" id="host-btn" class="btn-cyber" style="--clr: var(--aura-cyan)">[ Generate Node ID ]</button>
            <div id="node-info" class="hidden"><div id="id-display">--- --- ---</div></div>
            <div class="h-px w-40 bg-white/10 my-10"></div>
            <input type="text" id="target-id" placeholder="NODE ID" class="input-cyber">
            <button onclick="startClient()" id="client-btn" class="btn-cyber" style="--clr: var(--aura-magenta)">[ Sync Mobile ]</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('stage-canvas');
        const ctx = canvas.getContext('2d');
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let drops = [], rx = -1000, ry = -1000;

        function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); }
        function openManifest() {
            document.getElementById('manifest-frame').src = 'https://lisesanalyses-ux.github.io/MDA/AuraManifest.html';
            document.getElementById('manifest-container').style.display = 'flex';
            toggleMenu();
        }
        function closeManifest() { document.getElementById('manifest-container').style.display = 'none'; document.getElementById('manifest-frame').src = ''; }

        // LOGIKA PRUHU: MATCHING -> GLOW -> ROZPAD
        let cycle = 0; 
        let pStart = 10;

        function initStream() {
            const s = document.getElementById('ascii-decoder-stream');
            for(let i=0; i<30; i++) { const span = document.createElement('span'); span.id = `c-${i}`; s.appendChild(span); }
        }

        function updateStream() {
            cycle++;
            if(cycle > 130) { cycle = 0; pStart = Math.floor(Math.random()*24); }
            
            const p = ["2", "0", "2", "6"];
            for(let i=0; i<30; i++) {
                const el = document.getElementById(`c-${i}`);
                const isP = i >= pStart && i < pStart + 4;

                if (cycle > 80 && cycle <= 125 && isP) {
                    el.innerText = p[i-pStart]; el.className = "match-active"; 
                } else if (cycle > 60 && isP) {
                    el.innerText = Math.random() > 0.5 ? p[i-pStart] : chars[Math.floor(Math.random()*chars.length)];
                    el.className = "text-white opacity-100"; 
                } else {
                    el.innerText = chars[Math.floor(Math.random()*chars.length)];
                    el.className = ""; 
                }
            }
        }

        function initCanvas() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            drops = Array.from({length: 90}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*2+1 }));
        }

        function draw() {
            ctx.fillStyle = "rgba(0,0,0,0.15)"; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.font = "12px monospace";
            drops.forEach(d => {
                d.y += d.s;
                let dx = rx - d.x; let dy = ry - d.y;
                if(Math.sqrt(dx*dx + dy*dy) < 160) d.x -= dx * 0.06;
                if(d.y > canvas.height) d.y = -20;
                ctx.fillStyle = "rgba(0, 242, 255, 0.2)"; 
                ctx.fillText(chars[Math.floor(Math.random()*chars.length)], d.x, d.y);
            });
            requestAnimationFrame(draw);
        }

        let peer, conn;
        function startHost() {
            peer = new Peer(Math.random().toString(36).substr(2, 6).toUpperCase());
            peer.on('open', id => { 
                document.getElementById('host-btn').style.display='none'; 
                document.getElementById('node-info').classList.remove('hidden'); 
                document.getElementById('id-display').innerText = id.match(/.{1,3}/g).join('-'); 
            });
            peer.on('connection', c => { conn = c; conn.on('data', data => { rx = data.x * canvas.width; ry = data.y * canvas.height; }); });
        }

        function startClient() {
            const tid = document.getElementById('target-id').value.toUpperCase().replace(/-/g,'');
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect(tid);
                conn.on('open', () => { 
                    document.getElementById('client-btn').innerText = "[ SYNCED ]";
                    window.addEventListener('touchmove', e => { 
                        conn.send({ x: e.touches[0].clientX / window.innerWidth, y: e.touches[0].clientY / window.innerHeight }); 
                    }, {passive: false});
                });
            });
        }

        window.onload = () => { initCanvas(); draw(); initStream(); setInterval(updateStream, 80); };
        window.onresize = initCanvas;
    </script>
</body>
</html>