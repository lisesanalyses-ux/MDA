<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>PF 2026 | AuraManifest System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --aura-cyan: #00f2ff; --aura-magenta: #ff00ff; }
        body { background: #000; margin: 0; overflow: hidden; font-family: 'JetBrains Mono', monospace; color: var(--aura-cyan); }
        
        .scanlines::before {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.12) 50%);
            z-index: 1000; background-size: 100% 3px; pointer-events: none;
        }

        #ui-layer { position: absolute; z-index: 50; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #051010 0%, #000 100%); transition: 0.5s; }
        canvas { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 5; display: none; }

        /* iFrame Dokument kontejner */
        #doc-frame-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 150; display: none; background: #000;
        }
        iframe { width: 100%; height: 100%; border: none; }

        /* Sidebar */
        #sidebar {
            position: fixed; left: -300px; top: 0; width: 300px; height: 100vh;
            background: rgba(0, 10, 10, 0.95); border-right: 2px solid var(--aura-cyan);
            z-index: 200; transition: 0.4s cubic-bezier(0.85, 0, 0.15, 1);
            backdrop-filter: blur(15px); padding: 80px 20px; display: flex; flex-direction: column;
        }
        #sidebar.open { left: 0; box-shadow: 20px 0 50px rgba(0, 242, 255, 0.2); }
        
        .menu-trigger {
            position: fixed; left: 20px; top: 20px; z-index: 210;
            background: rgba(0,0,0,0.5); border: 1px solid var(--aura-cyan); color: var(--aura-cyan);
            width: 45px; height: 45px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }

        /* OV√ÅLN√Å TLAƒå√çTKA */
        .btn-oval {
            border: 1px solid var(--aura-cyan);
            padding: 10px 25px; border-radius: 50px;
            font-size: 10px; text-transform: uppercase; letter-spacing: 2px;
            text-decoration: none; color: var(--aura-cyan);
            background: rgba(0, 242, 255, 0.1); transition: all 0.4s ease;
            display: inline-flex; align-items: center; gap: 10px; cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
        }
        .btn-oval:hover { background: var(--aura-cyan); color: #000; box-shadow: 0 0 25px var(--aura-cyan); transform: translateY(-2px); }

        /* FIXN√ç TLAƒå√çTKO ZPƒöT (v≈ædy navrchu i nad framem) */
        #back-to-menu-global {
            position: fixed; top: 20px; right: 20px; z-index: 500; display: none;
        }

        .btn { border: 1px solid var(--aura-cyan); padding: 15px 30px; cursor: pointer; margin: 10px; text-transform: uppercase; font-weight: 800; transition: all 0.4s; letter-spacing: 3px; background: transparent; color: var(--aura-cyan); }
        .btn:hover { background: var(--aura-cyan); color: #000; box-shadow: 0 0 30px var(--aura-cyan); }

        .sidebar-link {
            display: block; width: 100%; text-align: left; color: var(--aura-cyan); padding: 15px;
            border: 1px solid rgba(0, 242, 255, 0.2); margin-bottom: 10px; font-size: 11px; text-transform: uppercase; transition: 0.3s;
            background: transparent; cursor: pointer;
        }
        .sidebar-link:hover { background: rgba(0, 242, 255, 0.1); border-color: var(--aura-cyan); padding-left: 25px; }

        #remote-id-input { background: rgba(0, 242, 255, 0.05); border: 1px solid var(--aura-cyan); color: #fff; padding: 12px; text-align: center; width: 250px; }
        .id-display { font-family: 'Share Tech Mono', monospace; font-size: 3.5rem; letter-spacing: 12px; color: #fff; text-shadow: 0 0 20px var(--aura-cyan); }
    </style>
</head>
<body class="scanlines">

    <button class="menu-trigger" onclick="toggleSidebar()">‚ò∞</button>

    <div id="back-to-menu-global">
        <button class="btn-oval" onclick="closeAllAndReturn()">
            <span class="text-xs">‚ü≤</span> BACK TO MENU
        </button>
    </div>

    <div id="doc-frame-container">
        <iframe id="doc-iframe" src=""></iframe>
    </div>

    <nav id="sidebar">
        <div class="mb-8 opacity-40 text-[10px] tracking-[4px]">CONTROL PANEL</div>
        <button class="sidebar-link" onclick="openDocFrame('https://lisesanalyses-ux.github.io/MDA/AuraManifest')">[01] AuraManifest Doc</button>
        <div class="h-px bg-cyan-900 my-4 opacity-30"></div>
        <button class="sidebar-link" onclick="location.reload()">[02] Reboot Core</button>
        
        <div class="mt-auto pb-10 flex flex-col gap-4">
            <a href="mailto:lisesanalyses@gmail.com" class="btn-oval">
                <span class="text-lg">‚úâ</span> lisesanalyses@gmail.com
            </a>
        </div>
    </nav>

    <div id="ui-layer">
        <h1 class="text-6xl mb-2 font-black text-center italic tracking-widest" style="text-shadow: 0 0 20px var(--aura-cyan);">PF 2026</h1>
        <p class="mb-12 text-sm tracking-widest opacity-60 uppercase text-center">Digital Synchronicity Interface</p>
        
        <div id="mode-selection" class="flex flex-col items-center">
            <button class="btn" onclick="initDisplayMode()">[ OPEN DISPLAY STAGE ]</button>
            <div class="h-px w-48 bg-cyan-900 my-8"></div>
            <input type="text" id="remote-id-input" placeholder="INSERT 6-CHAR ID">
            <button class="btn" onclick="initControllerMode()">[ SYNC MOBILE DEVICE ]</button>
            
            <div class="mt-12">
                <a href="https://auraadmin.online" target="_blank" class="btn-oval">
                    <span class="animate-pulse">üåê</span> AURAADMIN.ONLINE
                </a>
            </div>
        </div>
    </div>

    <canvas id="stage-canvas"></canvas>
    <video id="input-video" playsinline style="display:none;"></video>

    <script>
        const canvas = document.getElementById('stage-canvas');
        const ctx = canvas.getContext('2d');
        const videoElement = document.getElementById('input-video');
        
        let peer, conn, isController = false;
        let drops = [];
        let remoteX = -1000, remoteY = -1000, isFist = false;
        let gravityX = 0, gravityY = 0;
        const chars = "0123456789ABCDEF";

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        
        // Funkce pro otev≈ôen√≠ iFramu
        function openDocFrame(url) {
            const container = document.getElementById('doc-frame-container');
            const iframe = document.getElementById('doc-iframe');
            const backBtn = document.getElementById('back-to-menu-global');
            
            iframe.src = url;
            container.style.display = 'block';
            backBtn.style.display = 'block';
            if(document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
        }

        // N√°vrat do menu ze v≈°eho (Stage i iFramu)
        function closeAllAndReturn() {
            location.reload(); // Nejbezpeƒçnƒõj≈°√≠ zp≈Øsob pro reset PeerJS a stav≈Ø
        }

        function generateId() { return Math.random().toString(36).substr(2, 6).toUpperCase(); }

        function initDisplayMode() {
            const shortId = generateId();
            peer = new Peer(shortId);
            peer.on('open', (id) => {
                document.getElementById('mode-selection').innerHTML = `
                    <div class="text-center p-10 border border-cyan-500/30 bg-cyan-500/5 backdrop-blur-md">
                        <p class="text-[10px] opacity-50 tracking-[5px] mb-4">ACCESS KEY</p>
                        <p class="id-display mb-6">${id}</p>
                        <p class="animate-pulse text-cyan-400 text-xs tracking-widest uppercase">Awaiting Remote Sync...</p>
                    </div>`;
            });
            peer.on('connection', (c) => { conn = c; setupDataListener(); startEngine(); });
        }

        async function initControllerMode() {
            const remoteId = document.getElementById('remote-id-input').value.toUpperCase();
            if(!remoteId) return alert("ID Required");
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') { window.addEventListener('deviceorientation', handleOrientation); }
                } catch (e) { console.error(e); }
            } else { window.addEventListener('deviceorientation', handleOrientation); }
            isController = true;
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect(remoteId);
                conn.on('open', () => { startEngine(); });
            });
        }

        function handleOrientation(e) { gravityX = e.gamma / 45; gravityY = e.beta / 45; }

        function setupDataListener() {
            conn.on('data', (data) => {
                remoteX = data.x * canvas.width; remoteY = data.y * canvas.height;
                isFist = data.fist; gravityX = data.gx || 0; gravityY = data.gy || 0;
            });
        }

        class Drop {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.baseX = this.x; this.baseY = this.y;
                this.speed = Math.random() * 2 + 0.5;
                this.char = chars[Math.floor(Math.random()*chars.length)];
            }
            update() {
                let dx = remoteX - this.x; let dy = remoteY - this.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 200 && remoteX > -500) {
                    if (isFist) { this.x += dx * 0.1; this.y += dy * 0.1; }
                    else { this.x -= dx * 0.05; this.y -= dy * 0.05; }
                }
                this.x += gravityX * 10; this.y += gravityY * 10;
                this.x += (this.baseX - this.x) * 0.02;
                this.y += (this.baseY - this.y) * 0.02;
                this.baseY += this.speed;
                if (this.baseY > canvas.height) { this.baseY = -20; this.baseX = Math.random() * canvas.width; }
            }
            draw() {
                ctx.fillStyle = isFist ? "#ff00ff" : "rgba(0, 242, 255, 0.4)";
                ctx.font = "14px 'Share Tech Mono'";
                ctx.fillText(this.char, this.x, this.y);
            }
        }

        async function startEngine() {
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('back-to-menu-global').style.display = 'block';
            canvas.style.display = 'block';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (isController) {
                const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
                hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6 });
                hands.onResults(res => {
                    let sendX = -1000, sendY = -1000, sendFist = false;
                    if(res.multiHandLandmarks?.[0]) {
                        const lms = res.multiHandLandmarks[0];
                        sendX = (1 - lms[8].x); sendY = lms[8].y;
                        sendFist = (Math.hypot(lms[8].x - lms[0].x, lms[8].y - lms[0].y) < 0.25);
                    }
                    if(conn?.open) { conn.send({ x: sendX, y: sendY, fist: sendFist, gx: gravityX, gy: gravityY }); }
                });
                new Camera(videoElement, { onFrame: async () => { await hands.send({image: videoElement}); }, width: 640, height: 480 }).start();
            } else {
                for(let i=0; i<250; i++) drops.push(new Drop());
                render();
            }
        }

        function render() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drops.forEach(d => { d.update(); d.draw(); });
            requestAnimationFrame(render);
        }

        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    </script>
</body>
</html>